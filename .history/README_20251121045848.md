# Ansible_Deployment_Stage5


# Ansible Multi-Environment Deployment - []

## ‚ö†Ô∏è Critical Rules Compliance

- ‚úÖ **ONE Playbook**: `deploy.yml` handles BOTH staging and production
- ‚úÖ **No CI/CD**: Pure configuration management with Ansible
- ‚úÖ **Vault Encrypted**: SSH keys encrypted in `group_vars/all/vault.yml`
- ‚úÖ **Jinja2 Templates**: Nginx configs are templated, not static
- ‚úÖ **CloudWatch Logs**: EXACT naming format `/ec2/{env}/{project}/{component}`
- ‚úÖ **No SSH Debugging**: All logs shipped to CloudWatch

## Environments

| Environment | Domain | Server IP | Inventory File |
|------------|--------|-----------|----------------|
| Staging | staging.yourproject.com | X.X.X.X | `inventory/staging` |
| Production | yourproject.com | Y.Y.Y.Y | `inventory/production` |

## Team Structure
- **Team Lead**: [Name] - Integration, Vault, Coordination
- **Infrastructure & Security**: [Name] - SSH, Secrets, Vault
- **Application Deployment**: [Name] - Dependencies, Git, PM2
- **Web Server & SSL**: [Name] - Nginx, Certbot, HTTPS
- **CloudWatch Agent**: [Name] - Agent installation
- **Log Streaming**: [Name] - Log configuration

## Deployment Commands
```bash
# Deploy to Staging
ansible-playbook -i inventory/staging deploy.yml --ask-vault-pass

# Deploy to Production  
ansible-playbook -i inventory/production deploy.yml --ask-vault-pass

# Deploy specific role only
ansible-playbook -i inventory/staging deploy.yml --tags "nginx" --ask-vault-pass
```

## CloudWatch Log Groups (STRICT FORMAT)
- Application: `/ec2/{env}/yourproject/app`
- Nginx Access: `/ec2/{env}/yourproject/nginx-access`
- Nginx Error: `/ec2/{env}/yourproject/nginx-error`

## Submission Checklist
- [ ] ONE playbook (`deploy.yml`) works for both environments
- [ ] Vault encrypted SSH key
- [ ] HTTPS working on both domains
- [ ] CloudWatch logs in EXACT format `/ec2/{env}/{project}/{component}`
- [ ] Video demo showing: playbook run ‚Üí HTTPS site ‚Üí CloudWatch logs
- [ ] Repository link submitted
- [ ] Deadline: Nov 19, 2025 - 21:00 GMT+1
```

---

## üéØ Your Immediate Action Items (Priority Order):

1. ‚úÖ **Create GitHub repo** (private)
2. ‚úÖ **Create .gitignore** (secrets/, *.key, .vault_pass)
3. ‚úÖ **SSH into Ansible Controller**
4. ‚úÖ **Install Ansible** on controller
5. ‚úÖ **Clone your repo** to controller
6. ‚úÖ **Get the deployment SSH key** from instructor
7. ‚úÖ **Create and encrypt vault.yml** with the SSH key
8. ‚úÖ **Get actual server IPs** for staging and production
9. ‚úÖ **Update inventory files** with real IPs
10. ‚úÖ **Test ansible ping** to both servers
11. ‚úÖ **Create secrets/staging.env and secrets/prod.env**
12. ‚úÖ **Commit initial structure** (WITHOUT secrets!)
13. ‚úÖ **Share repo + vault password** with team (securely)

---

## ‚ö†Ô∏è Critical Reminders for Team

**Share this with your team:**
```
üö® CRITICAL RULES - READ CAREFULLY üö®

1. We have ONE playbook (deploy.yml) - it handles BOTH environments
2. Environment detection is automatic via inventory files
3. NEVER commit anything in secrets/ directory
4. NEVER commit unencrypted SSH keys
5. Nginx configs MUST be Jinja2 templates (.j2)
6. CloudWatch log groups MUST be: /ec2/{env}/{project}/{component}
   - Example: /ec2/staging/yourproject/app
   - If you use /var/log/app or anything else = AUTOMATIC ZERO
7. No SSH debugging allowed - CloudWatch must have all logs
8. PM2 or SystemD must auto-restart on reboot

Vault Password: [Share via secure channel - Slack DM, Signal, etc.]

Deadline: Nov 19, 2025 - 21:00 GMT+1